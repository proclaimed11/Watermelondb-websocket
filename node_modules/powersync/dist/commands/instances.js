import { Command, ux } from '@oclif/core';
import * as AccountsClient from '../service/accounts.client.js';
import * as PowerSyncClient from '../service/powersync.client.js';
import { bold, checkThatEnvVariablesAreSet, green, red } from '../utils.js';
export default class InstancesList extends Command {
    static description = 'View list of instances.';
    static examples = ['<%= config.bin %> <%= command.id %>'];
    async run() {
        checkThatEnvVariablesAreSet(this.config.bin, false);
        const project = await AccountsClient.getCurrentPowerSyncProject();
        const list = await PowerSyncClient.getInstancesList();
        const { instances } = list;
        if (instances.length === 0) {
            return ux.log(`It seems like you have ${red('no')} instances. Run ${green(`"npx ${this.config.bin} instance create"`)} to create your first instance.`);
        }
        ux.log(`Your ${bold('project')} is currently set to ${green(project.name)}.`);
        if (process.env.INSTANCE_ID) {
            const currentInstance = instances.find((instance) => instance.id === process.env.INSTANCE_ID);
            if (currentInstance) {
                ux.log(`Your ${bold('instance')} is currently set to ${green(currentInstance.name)}.\n`);
            }
        }
        ux.table(instances, {
            id: { header: 'ID' },
            name: { minWidth: 7 }
        }, { printLine: this.log.bind(this) });
        ux.log(`\nRun ${green(`"npx ${this.config.bin} instance set"`)} to use one of the instances.`);
    }
}
